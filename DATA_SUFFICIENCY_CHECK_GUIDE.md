# 數據量檢查功能說明

## 🎯 **新增功能概述**

✅ **智能數據量預檢查** - 在執行策略前就判斷數據是否充足，避免無效執行！

---

## 🔍 **功能特點**

### **預檢查機制**
- 🚀 **執行前檢查**: 在策略計算前就驗證數據充足性
- ❌ **提前終止**: 數據不足時直接終止，不浪費計算資源
- 💡 **智能建議**: 提供具體的解決方案和替代選擇

### **檢查項目**
1. **基本數據量**: 檢查是否有足夠的歷史數據天數
2. **交易對過濾**: 檢查是否有交易對能通過 `skip_first_n_days` 條件
3. **因子窗口**: 檢查各因子所需的最大數據窗口是否滿足
4. **日期範圍**: 檢查目標日期是否在可用數據範圍內

---

## 📊 **策略數據要求總覽**

| 策略名稱 | 最少數據 | 跳過天數 | 總需求 | 最大因子窗口 | 實際最低要求 |
|---------|---------|---------|--------|-------------|-------------|
| **test_factor_simple** | 7天 | 0天 | 7天 | 7天 | **7天** |
| **cerebrum_core** | 30天 | 3天 | 33天 | 90天 | **93天** |
| **cerebrum_momentum** | 60天 | 5天 | 65天 | 90天 | **95天** |
| **cerebrum_stability** | 90天 | 7天 | 97天 | 90天 | **97天** |

---

## 🚨 **檢查結果說明**

### **✅ 檢查通過**
```
✅ 數據量檢查通過: 數據充足：可用數據 31 天，滿足策略要求
```
- 策略將正常執行
- 可以期待獲得完整結果

### **❌ 檢查失敗**
```
❌ 數據量檢查失敗: 數據量不足：策略需要 33 天數據，但只有 31 天可用
💡 建議:
   • 使用較晚的日期 (如最新日期)
   • 選擇數據要求較低的策略 (如 test_factor_simple)
   • 確保有足夠的歷史數據
```
- 策略不會執行
- 系統提供具體建議

---

## 🛠️ **使用方式**

### **交互式界面** (推薦)
```bash
python factor_strategies/run_factor_strategies.py
```
- 系統自動進行數據量檢查
- 失敗時會詢問是否查看策略詳細要求
- 提供友好的錯誤信息和建議

### **程式化調用**
```python
from factor_strategies.factor_engine import FactorEngine

engine = FactorEngine()

# 預檢查數據充足性
is_sufficient, message = engine.check_data_sufficiency('cerebrum_core', '2025-01-31')

if is_sufficient:
    result = engine.run_strategy('cerebrum_core', '2025-01-31')
else:
    print(f"數據不足: {message}")
```

---

## 📈 **實際案例**

### **案例1: 成功執行**
```
策略: test_factor_simple
日期: 2025-01-08
結果: ✅ 數據充足：可用數據 8 天，滿足策略要求
```

### **案例2: 數據量不足**
```
策略: cerebrum_core
日期: 2025-01-31
結果: ❌ 數據量不足：策略需要 33 天數據，但只有 31 天可用
```

### **案例3: 交易對過濾問題**
```
策略: cerebrum_momentum
日期: 2025-01-05
結果: ❌ 無交易對符合條件：所有交易對上線時間不足 5 天
```

### **案例4: 因子窗口不足**
```
策略: cerebrum_stability
日期: 2025-01-31
結果: ❌ 因子計算數據不足：最大因子窗口需要 97 天，但只有 31 天可用
```

---

## 💡 **解決方案指南**

### **問題: 數據量不足**
**解決方案**:
1. **使用最新日期**: 選擇數據範圍內的最晚日期
2. **選擇簡單策略**: 使用 `test_factor_simple` 進行測試
3. **等待更多數據**: 收集更長時間的歷史數據

### **問題: 交易對過濾**
**解決方案**:
1. **延後執行日期**: 等到交易對上線足夠天數
2. **調整策略配置**: 降低 `skip_first_n_days` 參數 (需要修改配置)

### **問題: 因子窗口過大**
**解決方案**:
1. **選擇窗口較小的策略**: 如 `test_factor_simple` (7天窗口)
2. **等待足夠數據**: 收集滿足最大窗口要求的數據
3. **自定義策略**: 創建窗口較小的新策略

---

## 🎯 **最佳實踐**

### **日常使用建議**:
1. **優先使用最新日期**: 通常有最完整的數據
2. **從簡單策略開始**: 先用 `test_factor_simple` 驗證系統
3. **查看詳細要求**: 失敗時查看策略的具體數據要求
4. **逐步升級**: 隨著數據積累，逐步使用更複雜的策略

### **策略選擇順序** (按數據要求遞增):
1. **test_factor_simple** (7天) - 測試和快速驗證
2. **cerebrum_core** (93天) - 日常使用的平衡策略  
3. **cerebrum_momentum** (95天) - 趨勢交易
4. **cerebrum_stability** (97天) - 保守投資

---

## 🎊 **功能價值**

### **用戶體驗提升**:
- ⚡ **節省時間**: 避免執行註定失敗的策略
- 🎯 **明確指導**: 清楚知道為什麼失敗以及如何解決
- 💡 **智能建議**: 系統主動推薦可行的替代方案

### **系統穩定性**:
- 🛡️ **錯誤預防**: 在問題發生前就攔截
- 📊 **資源優化**: 不浪費計算資源在無效執行上
- 🔍 **問題診斷**: 精確定位數據不足的具體原因

---

**🎯 現在您可以放心使用因子策略系統，系統會智能地告訴您哪些策略可以執行，哪些需要等待更多數據！** 